<div class="container-fluid p-0 d-flex h-100">
  <app-dynamic-menus></app-dynamic-menus>

  <div class="bg-light flex-fill">
    <div class="p-2 d-md-none d-flex text-white bg-success">
      <a href="dashboard" class="text-white" data-bs-toggle="offcanvas" data-bs-target="#bdSidebar">
        <i class="fa-solid fa-bars"></i>
      </a>
      <span class="ms-3">sangh</span>
    </div>
    <div class="p-4">
      <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <a class="navbar-brand" href="dashboard"
            style="float: right;position: absolute;right: 1px;padding-right: 0px;margin-right:0px;font-size: 15px;">Welcome:{{userSessionDetails?.username}}</a>
        </div>
      </nav>
      <hr>
      <div class="row">
        <div class="container">
          <div class="row" style=" background-color: #f1f5fd !important; margin-top: 15px; margin-bottom: 15px;">
            <div class="col-lg-12">
              <h1 style="text-align:center">Event Management - Families</h1>
            </div>
            <div class="col-lg-12">
              <!-- Create Event Form -->
              <div class="card mb-4">
                <div class="card-header">
                  <h5>Create New Event</h5>
                </div>
                <div class="card-body">
                  <form (ngSubmit)="createEvent()">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="eventName" class="form-label">Event Name</label>
                          <input type="text" class="form-control" id="eventName" [(ngModel)]="createEventRequest.eventName" name="eventName" required>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="description" class="form-label">Description</label>
                          <input type="text" class="form-control" id="description" [(ngModel)]="createEventRequest.description" name="description" required>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-3">
                        <div class="mb-3">
                          <label for="startDate" class="form-label">Start Date</label>
                          <input type="datetime-local" class="form-control" id="startDate" [(ngModel)]="createEventRequest.startDate" name="startDate" required>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="mb-3">
                          <label for="endDate" class="form-label">End Date</label>
                          <input type="datetime-local" class="form-control" id="endDate" [(ngModel)]="createEventRequest.endDate" name="endDate" required>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="mb-3">
                          <label for="location" class="form-label">Location</label>
                          <input type="text" class="form-control" id="location" [(ngModel)]="createEventRequest.location" name="location" required>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="mb-3">
                          <label for="capacity" class="form-label">Capacity</label>
                          <input type="number" class="form-control" id="capacity" [(ngModel)]="createEventRequest.capacity" name="capacity" required>
                        </div>
                      </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Event</button>
                  </form>
                  <div *ngIf="createEventMessage" class="alert mt-3" [ngClass]="{'alert-success': createEventStatus === '200', 'alert-danger': createEventStatus !== '200'}">
                    {{ createEventMessage }}
                  </div>
                </div>
              </div>

              <!-- All Registered Families Across Events -->
              <div class="card mb-4" *ngIf="allRegisteredFamilies && allRegisteredFamilies.length > 0">
                <div class="card-header">
                  <h5>All Registered Families Across Events</h5>
                  <button type="button" class="btn btn-success float-end me-2" (click)="selectFamiliesForAll()">Select Selected Families (All Events)</button>
                  <button type="button" class="btn btn-danger float-end" (click)="deleteUnselectedFamiliesForAll()">Delete Unselected Families (All Events)</button>
                </div>
                <div class="card-body">
                  <div *ngFor="let eventGroup of allRegisteredFamilies; let groupIndex = index">
                    <h6 class="mt-3 mb-2">{{ eventGroup.event.eventName }} (Event ID: {{ eventGroup.event.id }}) - Families: {{ eventGroup.families.length }}</h6>
                    <ng-container *ngFor="let family of eventGroup.families; let i = index">
                      <div class="family-card mb-3 p-3 border">
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox" [(ngModel)]="selectedFamilyIds[groupIndex * 100 + i]" [id]="'head-' + (family.head?.userid || (groupIndex * 100 + i))">
                          <label class="form-check-label" [for]="'head-' + (family.head?.userid || (groupIndex * 100 + i))">
                            Select Family
                          </label>
                        </div>
                        <h6>Head: {{ family.head?.firstName || 'N/A' }} {{ family.head?.middleName || '' }} {{ family.head?.lastName || '' }} (ID: {{ family.head?.userid || 'N/A' }})</h6>
                        <p>Gender: {{ family.head?.gender || 'N/A' }} | City: {{ family.head?.city || 'N/A' }} | Mobile: {{ family.head?.mobileNumber || 'N/A' }} | Email: {{ family.head?.email || 'N/A' }}</p>
                        <h6>Family Members ({{ (family.members || []).length }})</h6>
                        <table class="table table-sm" *ngIf="(family.members || []).length > 0">
                          <thead>
                            <tr>
                              <th>ID</th>
                              <th>First Name</th>
                              <th>Middle Name</th>
                              <th>Last Name</th>
                              <th>Gender</th>
                              <th>City</th>
                              <th>Number</th>
                              <th>Email</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let member of (family.members || [])">
                              <td>{{ member?.userid || 'N/A' }}</td>
                              <td>{{ member?.firstName || 'N/A' }}</td>
                              <td>{{ member?.middleName || 'N/A' }}</td>
                              <td>{{ member?.lastName || 'N/A' }}</td>
                              <td>{{ member?.gender || 'N/A' }}</td>
                              <td>{{ member?.city || 'N/A' }}</td>
                              <td>{{ member?.mobileNumber || 'N/A' }}</td>
                              <td>{{ member?.email || 'N/A' }}</td>
                            </tr>
                          </tbody>
                        </table>
                        <p *ngIf="(family.members || []).length === 0" class="text-muted">No family members.</p>
                      </div>
                    </ng-container>
                  </div>
                  <div *ngIf="allRegisteredFamilies.length === 0" class="text-center text-muted">
                    No families to display.
                  </div>
                </div>
              </div>

              <!-- All Confirmed Families Across Events -->
              <div class="card mb-4" *ngIf="allConfirmedFamilies && allConfirmedFamilies.length > 0">
                <div class="card-header">
                  <h5>All Confirmed Families Across Events</h5>
                </div>
                <div class="card-body">
                  <div *ngFor="let eventGroup of allConfirmedFamilies">
                    <h6 class="mt-3 mb-2">{{ eventGroup.event.eventName }} (Event ID: {{ eventGroup.event.id }}) - Families: {{ eventGroup.families.length }}</h6>
                    <ng-container *ngFor="let family of eventGroup.families">
                      <div class="family-card mb-3 p-3 border">
                        <h6>Head: {{ family.head?.firstName || 'N/A' }} {{ family.head?.middleName || '' }} {{ family.head?.lastName || '' }} (ID: {{ family.head?.userid || 'N/A' }})</h6>
                        <p>Gender: {{ family.head?.gender || 'N/A' }} | City: {{ family.head?.city || 'N/A' }} | Mobile: {{ family.head?.mobileNumber || 'N/A' }} | Email: {{ family.head?.email || 'N/A' }}</p>
                        <h6>Family Members ({{ (family.members || []).length }})</h6>
                        <table class="table table-sm" *ngIf="(family.members || []).length > 0">
                          <thead>
                            <tr>
                              <th>ID</th>
                              <th>First Name</th>
                              <th>Middle Name</th>
                              <th>Last Name</th>
                              <th>Gender</th>
                              <th>City</th>
                              <th>Number</th>
                              <th>Email</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let member of (family.members || [])">
                              <td>{{ member?.userid || 'N/A' }}</td>
                              <td>{{ member?.firstName || 'N/A' }}</td>
                              <td>{{ member?.middleName || 'N/A' }}</td>
                              <td>{{ member?.lastName || 'N/A' }}</td>
                              <td>{{ member?.gender || 'N/A' }}</td>
                              <td>{{ member?.city || 'N/A' }}</td>
                              <td>{{ member?.mobileNumber || 'N/A' }}</td>
                              <td>{{ member?.email || 'N/A' }}</td>
                            </tr>
                          </tbody>
                        </table>
                        <p *ngIf="(family.members || []).length === 0" class="text-muted">No family members.</p>
                      </div>
                    </ng-container>
                  </div>
                  <div *ngIf="allConfirmedFamilies.length === 0" class="text-center text-muted">
                    No confirmed families to display.
                  </div>
                </div>
              </div>

              <div *ngIf="message" class="alert" [ngClass]="{'alert-success': status === '200', 'alert-danger': status !== '200'}">
                {{ message }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<app-footer></app-footer>